<!doctype html>
<html lang="en">
<head>
  <title>Vulnerabilities for scanned systems</title>
  <!-- metadata -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Vulnerabilities vertTextfor scanned system"/>
  <meta name="author" content="NorthernSec"/>
</head>
<body>
  <div class="well">
    <table>
      <tr><td>Scanned on</td><td>{{scan['time']}}</td></tr>
      <tr><td>Enhanced on</td><td>{{enhanced['time']}}</td></tr>
    </table>
  </div>
  {% if systems|length == 0 %}
    <div class="well">No hosts were scanned.</div>
  {% else %}
    {% for sys in systems %}
      <table class="table table-condensed table-striped">
        <tr><td class="warning">IP</td>     <td>{{sys['ip']}}</td></tr>
        <tr><td class="warning">MAC</td>    <td>{{sys['mac']}}</td></tr>
        <tr><td class="warning">Status</td> <td>{{sys['status']}}</td></tr>
        <tr><td class="warning">Possible CPEs</td>
            <td>
              {% if sys['cpes']|length == 0 %}
                System not recognized
              {% else %}
                <ul>
                  {%for cpe in sys['cpes'] %}
                    <li>{{ cpe['cpe'] }}
                        {% if "appendix" in cpe %}
                          <span class="referal">* Vulns in Appendix {{ cpe["appendix"] }}</span>
                        {% endif %}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            </td>
        </tr>
        {% if sys['status']=='up'%}
          <tr><td class="warning">Vendor</td> <td>{{sys['vendor']}}</td></tr>
          <tr><td class="warning">Hostnames</td> 
              <td>
                <ul>
                  {% for h in sys['hostnames'] %}<li>{{h}}</li>{% endfor %}
                </ul>
              </td>
          </tr>
          <tr><td class="warning">Distance</td>  <td>{{sys['distance']}}</td></tr>
          <tr><td class="warning">Services</td>
              <td>
                {% if sys['services']|length == 0 %}
                  No services found for this host
                {% else %}
                  <table class="table table-hover table-striped services">
                    <thead>
                      <tr class="warning"><td>Service</td><td>Product</td><td>Port/Protocol</td><td>Status</td><td>Appendix</td></tr>
                    </thead>
                    {% for s in sys['services'] %}
                      <tr>
                        <td>{{s['name']}}</td>
                        <td>{{s['banner']}}</td>
                        <td>port {{s['port']}}/{{s['protocol']}}</td>
                        <td>{{s['state']}}</td>
                        <td class="nonfluid">
                          {% if "appendix" in s %} {{ s["appendix"] }} {% endif %}
                        </td>
                      </tr>
                    {% endfor %}
                  </table>
                {% endif %}
              </td>
          </tr>
        {% endif %}
      </table>
    {% endfor %}
    {% if appendixes %}
      {% for appendix in appendixes %}
        <p style="page-break-before: always" ></p>
        <h1>Appendix {{ loop.index }}</h1>
        <table>
          <tr class="warning vertTable"><td>CVE</td>
            <td>Confidentiality</td><td>Integrity</td><td>Availability</td>
            <td>Complexibility</td><td>Authentication</td><td>Vector</td>
            <td>Exploit DB</td><td>MSF</td></tr>
          {% for cve in appendix %}
            <tr class="textInMid">
              <td>{{ cve["id"] }}</td>
              {% if "impact" in cve %}
                <td>{{ cve["impact"]["confidentiality"][0] }}</td>
                <td>{{ cve["impact"]["integrity"][0] }}</td>
                <td>{{ cve["impact"]["availability"][0] }}</td>
              {% else %}
                <td>?</td><td>?</td><td>?</td>
              {% endif %}
              {% if "access" in cve %}
                <td>{{ cve["access"]["complexity"][0] }}</td>
                <td>{{ cve["access"]["authentication"][0] }}</td>
                <td>{{ cve["access"]["vector"][0] }}</td>
              {% else %}
                <td>?</td><td>?</td><td>?</td>
              {% endif %}
              {% if "map_cve_exploitdb" in cve %} <td>x</td>{% else %}<td></td>{% endif %}
              {% if "map_cve_msf" in cve %} <td>x</td> {% else %}<td></td>{% endif %}
            </tr>
          {% endfor %}
        </table>
      {% endfor %}
    {% endif %}
  {% endif %}
</body>
</html>
